name: Trigger Release

on:
  workflow_dispatch:

jobs:
  release:
    runs-on: 'ubuntu-latest'
    steps:
    - uses: actions/checkout@v4

    - name: Assemble release notes
      uses: miniscruff/changie-action@v2
      with:
        args: batch auto

    - name: Update changelog
      uses: miniscruff/changie-action@v2
      with:
        args: merge

    - name: Determine release version
      id: release_version
      uses: miniscruff/changie-action@v2
      with:
        args: latest # NB: changie already decided!

    - name: Commit changelog
      run: |
          git config user.name "${{ github.actor }}"
          git config user.email "${{ github.actor_id }}+${{ github.actor }}@users.noreply.github.com"
          git commit -m "chore(doc): CHANGELOG for ${{ steps.release_version.outputs.output }}"
          git push origin

    - name: Create tag
      run: |
          git tag ${{ steps.release_version.outputs.output }}
          git push origin ${{ steps.release_version.outputs.output }}
